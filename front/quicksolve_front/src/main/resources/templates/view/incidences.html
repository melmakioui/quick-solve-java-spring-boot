<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    <title th:text="#{incidencias.titulo1}"></title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0"/>
    <link rel="stylesheet" th:href="@{/css/pagination-min.css}">
</head>

<body>

<th:block th:include="view/fragments/sub-incidence-nav"></th:block>

<main class="d-flex flex-nowrap flex-column justify-content-center mx-6">

    <h1 class="mt-4" th:text="#{incidencias.titulo1}"></h1>

    <div class="d-flex justify-content-end align-items-end mb-3">

        <span class="fs-1 text-secondary material-symbols-outlined" style="user-select: none">filter_list</span>
        <div class=" mx-2 d-flex flex-column align-items-start">
            <span class="mx-2" th:text="#{formupt.campo3}"></span>
            <select class="form-select mx-2" name="department" id="dep">
                <option th:text="#{filter.todos}" th:value="0" selected></option>
                <option th:each="dep : ${departments}" th:value="${dep.name}" th:text="${dep.name}"></option>
            </select>
        </div>

        <div class=" mx-2">
            <span th:text="#{formupt.campo4}"></span>
            <select class="form-select" name="department" id="spa">
                <option th:text="#{filter.todos}" th:value="0" selected></option>
                <option th:each="spa : ${spaces}" th:value="${spa.name}" th:text="${spa.name}"></option>
            </select>
        </div>

        <div>
            <button id="reset-filter" class="btn btn-secondary" type="button">RESET</button>
        </div>
    </div>

    <div class="accordion mb-5" id="accordion">
        <div class="accordion-item" th:each="state : ${status}">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        aria-expanded="false" th:text="${state.name}"
                        th:attr="data-bs-target='#' + ${#strings.replace(state.name,' ','')}, aria-controls=${state.name}">

                </button>
            </h2>
            <div th:id="${#strings.replace(state.name,' ','')}"
                 th:class="${state.id == 1} ? 'accordion-collapse collapse show' : 'accordion-collapse collapse'"
                 aria-labelledby="headingOne"
                 data-bs-parent="#accordion">

                <div class="accordion-body d-flex flex-wrap justify-content-center justify-content-md-start incidences">

                    <div th:if="${state.id == 1 or state.id == 3}"
                         id="new-incidence"
                         class="card card-animation mx-2 bg-primary mb-4"
                         style="width: 18rem; height: 122px;"
                         th:onclick="|window.location.href='@{/incidencia/nueva}'|">
                        <div class="card-body d-flex justify-content-center">
                            <svg width="90px" height="90px" viewBox="-1.2 -1.2 26.40 26.40" fill="none"
                                 xmlns="http://www.w3.org/2000/svg" stroke="#ff9900">
                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round"
                                   stroke-linejoin="round"></g>
                                <g id="SVGRepo_iconCarrier">
                                    <path d="M13 3H7C5.89543 3 5 3.89543 5 5V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V9M13 3L19 9M13 3V8C13 8.55228 13.4477 9 14 9H19M12 13V17M14 15H10"
                                          stroke="#ff990" stroke-width="2" stroke-linecap="round"
                                          stroke-linejoin="round"></path>
                                </g>
                            </svg>
                        </div>
                    </div>

                    <div th:class="'card card-animation card mb-4 mx-2 incidence '+ ${#strings.replace(state.name,' ','')}"
                         th:each="incidence : ${incidences}"
                         th:if="${incidence.incidenceState.id == state.id}"
                         style="width: 18rem;"
                         th:onclick="'window.location.href=\'' + @{/incidencia/} + ${incidence.id} + '\''"
                         th:attr="data-department=${incidence.department == null ? 'no-dep' : incidence.department.name },
                                       data-space=${incidence.space == null ? 'no-space' : incidence.space.name } ">
                        <div class="card-body">
                            <h5 class="card-title text-truncate" th:text="${incidence.title}"></h5>
                            <p class="card-text text-truncate mb-1"
                               th:text="${incidence.description}"></p>
                            <div class="d-flex justify-content-between">
                                <small th:text="${incidence.daysAgo}"></small>

                                <div th:if="${incidence.incidenceStateId == 1}">
                                    <a th:href="@{/incidencia/modificar/} + ${incidence.id}"
                                       class="icons-crud mx-1 text-primary"><span disabled="disabled"
                                                                                  class="material-symbols-outlined">edit</span></a>
                                    <a data-bs-toggle="modal" data-bs-target="#deleteIncidence"
                                       th:attr="data-link='/incidencia/cancelar/' + ${incidence.id}"
                                       class="icons-crud text-danger mx-1 text-delete btnDelModal"><span
                                            disabled="disabled"
                                            class="material-symbols-outlined">close</span></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-end p-3">
                    <div class="pagination mx-3"></div>
                </div>
            </div>
        </div>

    </div>
</main>

<div class="modal fade" id="deleteIncidence" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-primary text-texto-contraste">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel" th:text="#{incidencia.eliminar.titulo}"></h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" th:text="#{incidencia.eliminar.mensaje}"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary text-texto-contraste" data-bs-dismiss="modal"
                        th:text="#{incidencia.eliminar.cancelar}"></button>
                <a id="delBtnModal">
                    <button type="button" class="btn btn-secondary" th:text="#{incidencia.eliminar.boton}"></button>
                </a>
            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>

<script th:src="@{/js/jquery-3.6.3-min.js}"></script>
<script th:src="@{/js/pagination-min.js}"></script>
<script th:src="@{/js/activeLinks.js}"></script>
<script th:src="@{/js/filterDepSpa.js}"></script>
<script th:src="@{/js/deleteModal.js}"></script>
<script th:src="@{/js/pagination.js}"></script>


</body>

</html>
