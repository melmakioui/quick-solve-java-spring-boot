/*! Image Uploader - v1.2.3 - 26/11/2019
 * Copyright (c) 2019 Christian Bayer; Licensed MIT */ !function(e){e.fn.imageUploader=function(t){let n={preloaded:[],imagesInputName:"images",preloadedInputName:"preloaded",label:"Drag & Drop files here or click to browse",extensions:[".jpg",".jpeg",".png",".gif",".svg"],mimes:["image/jpeg","image/png","image/gif","image/svg+xml"],maxSize:void 0,maxFiles:void 0},i=this,s=new DataTransfer,a;i.settings={},i.init=function(){i.settings=e.extend(i.settings,n,t),i.each(function(t,n){let s=d();if(e(n).append(s),s.on("dragover",r.bind(s)),s.on("dragleave",r.bind(s)),s.on("drop",p.bind(s)),i.settings.preloaded.length){s.addClass("has-files");let a=s.find(".uploaded");for(let o=0;o<i.settings.preloaded.length;o++)a.append(l(i.settings.preloaded[o].src,i.settings.preloaded[o].id,!0))}})};let d=function(){let t=e("<div>",{class:"image-uploader"});a=e("<input>",{type:"file",id:i.settings.imagesInputName+"-"+v(),name:i.settings.imagesInputName+"[]",accept:i.settings.extensions.join(","),multiple:""}).appendTo(t),e("<div>",{class:"uploaded"}).appendTo(t);let n=e("<div>",{class:"upload-text"}).appendTo(t);return e("<i>",{class:"iui-cloud-upload"}).appendTo(n),e("<span>",{text:i.settings.label}).appendTo(n),t.on("click",function(e){o(e),a.trigger("click")}),a.on("click",function(e){e.stopPropagation()}),a.on("change",p.bind(t)),t},o=function(e){e.preventDefault(),e.stopPropagation()},l=function(t,n,d){let l=e("<div>",{class:"uploaded-image"}),r=(e("<img>",{src:t}).appendTo(l),e("<button>",{class:"delete-image"}).appendTo(l));return e("<i>",{class:"iui-close"}).appendTo(r),d?(l.attr("data-preloaded",!0),e("<input>",{type:"hidden",name:i.settings.preloadedInputName+"[]",value:n}).appendTo(l)):l.attr("data-index",n),l.on("click",function(e){o(e)}),r.on("click",function(t){o(t);let d=l.parent();if(!0===l.data("preloaded"))i.settings.preloaded=i.settings.preloaded.filter(function(e){return e.id!==n});else{let r=parseInt(l.data("index"));d.find(".uploaded-image[data-index]").each(function(t,n){t>r&&e(n).attr("data-index",t-1)}),s.items.remove(r),a.prop("files",s.files)}l.remove(),d.children().length||d.parent().removeClass("has-files")}),l},r=function(t){o(t),"dragover"===t.type?e(this).addClass("drag-over"):e(this).removeClass("drag-over")},p=function(t){o(t);let n=e(this),d=Array.from(t.target.files||t.originalEvent.dataTransfer.files),l=[];e(d).each(function(e,t){(!i.settings.extensions||c(t))&&(!i.settings.mimes||u(t))&&(!i.settings.maxSize||f(t))&&(!i.settings.maxFiles||m(l.length,t))&&l.push(t)}),l.length?(n.removeClass("drag-over"),h(n,l)):a.prop("files",s.files)},g=document.querySelector(".alert"),c=function(t){if(0>i.settings.extensions.indexOf(t.name.replace(RegExp("^.*\\."),"."))){let n=e("#alert-content-type");return n.removeClass("d-none"),!1}return g.classList.add("d-none"),!0},u=function(t){if(0>i.settings.mimes.indexOf(t.type)){let n=e("#alert-content-type");return n.removeClass("d-none"),!1}return g.classList.add("d-none"),!0},f=function(e){return!(e.size>i.settings.maxSize)||(alert(`The file "${e.name}" exceeds the maximum size of ${i.settings.maxSize/1024/1024}Mb`),!1)},m=function(t,n){if(t+s.items.length+i.settings.preloaded.length>=i.settings.maxFiles){let a=e("#alert-quantity");return a.removeClass("d-none"),!1}return g.classList.add("d-none"),!0},h=function(t,n){t.addClass("has-files");let i=t.find(".uploaded"),a=t.find('input[type="file"]');e(n).each(function(e,t){s.items.add(t),i.append(l(URL.createObjectURL(t),s.items.length-1),!1)}),a.prop("files",s.files)},v=function(){return Date.now()+Math.floor(100*Math.random()+1)};return this.init(),this}}(jQuery);